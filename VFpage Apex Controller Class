public class VFpageApexClassToCreateContact {
public Id selectedAccountId { get; set; }
    public String firstName { get; set; }
    public String lastName { get; set; }
    public String email { get; set; }
    public String phone { get; set; }

    public List<SelectOption> getAccountOptions() {
        List<SelectOption> options = new List<SelectOption>();
        List<Account> accList=[SELECT Id, Name FROM Account];
        for(Account acc :accList ) {
            options.add(new SelectOption(acc.Id, acc.Name));
        }
        return options;
    }
    public PageReference saveContact() {
        if(selectedAccountId == null) {
           ApexPages.Message errorMsg = new ApexPages.Message(
           ApexPages.Severity.ERROR,
           'Please select an Account.');
           ApexPages.addMessage(errorMsg);
            return null;
        }
        List<Contact> existingContacts = [SELECT Id FROM Contact WHERE Email != null AND Email = :email];
        if(!existingContacts.isEmpty()) {
           ApexPages.Message errorMsg = new ApexPages.Message(
           ApexPages.Severity.ERROR,
          'A Contact with this Email already exists.');
          ApexPages.addMessage(errorMsg);
            return null;
        }
        Contact newContact = new Contact();
            newContact.AccountId = selectedAccountId;
            newContact.FirstName = firstName;
            newContact.LastName = lastName;
            newContact.Email = email;
            newContact.Phone = phone;
        try {
            insert newContact;
            ApexPages.Message errorMsg = new ApexPages.Message(
            ApexPages.Severity.CONFIRM,
            'Contact created successfully related to selected Account!!!');
            ApexPages.addMessage(errorMsg);
            
            selectedAccountId = null;
            firstName = null;
            lastName = null;
            email = null;
            phone = null;
           } 
        catch(Exception e) {
           ApexPages.Message errorMsg = new ApexPages.Message(
           ApexPages.Severity.ERROR,
           'Error while creating contact: ' + e.getMessage());
           ApexPages.addMessage(errorMsg);
           }
        return null;
    }
}
